<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Share My Location</title>
  <style>
    body { font-family: system-ui, Arial; display:flex; height:100vh; align-items:center; justify-content:center; background:#f3f4f6; }
    .card { background:white; padding:24px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,.08); text-align:center; width:320px; }
    button { padding:12px 18px; font-size:16px; border-radius:8px; border:0; cursor:pointer; }
    .btn-primary { background:#2563eb; color:white; }
    .status { margin-top:12px; font-size:14px; color:#334155; min-height:20px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Share My Location</h2>
    <p>Click the button to share your location.</p>
    <button id="shareBtn" class="btn-primary">Share my location</button>
    <div class="status" id="status"></div>
  </div>

  <script>
    // Replace this with the site you want to redirect to AFTER sending location.
    // You can change it later.
    const REDIRECT_URL = "https://example.com/your-page"; // <-- edit this

    const shareBtn = document.getElementById('shareBtn');
    const statusEl = document.getElementById('status');

    shareBtn.addEventListener('click', async () => {
      statusEl.textContent = 'Requesting location permission...';

      if (!navigator.geolocation) {
        statusEl.textContent = 'Geolocation is not supported by this browser.';
        return;
      }

      // Request high accuracy (browser may ignore)
      navigator.geolocation.getCurrentPosition(success, error, { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 });

      function error(err) {
        console.error('Geolocation error', err);
        statusEl.textContent = 'Unable to get location: ' + (err.message || err.code);
      }

      async function success(position) {
        const coords = position.coords;
        const payload = {
          lat: coords.latitude,
          lon: coords.longitude,
          accuracy: coords.accuracy,
          altitude: coords.altitude,
          heading: coords.heading,
          speed: coords.speed,
          timestamp: position.timestamp
        };

        statusEl.textContent = 'Sending location to server...';

        try {
          // Adjust the server origin if your server is on another host/port
          const resp = await fetch('/report-location', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
          });

          if (!resp.ok) {
            const text = await resp.text();
            throw new Error('Server error: ' + resp.status + ' ' + text);
          }

          const json = await resp.json();
          statusEl.textContent = 'Location sent! Redirecting...';

          // Optional: small delay so user sees the status
          setTimeout(() => {
            window.location.href = REDIRECT_URL;
          }, 600);

        } catch (e) {
          console.error(e);
          statusEl.textContent = 'Failed to send location: ' + e.message;
        }
      }
    });
  </script>
</body>
</html>
